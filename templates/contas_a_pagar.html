{% extends "base.html" %}

{% block title %}Fluxo de Caixa - Contas a Pagar{% endblock %}

{% block content %}
    <div class="header">
        <h1>Contas a Pagar</h1>
    </div>

    <!-- Formulário de Nova Conta -->
    <div class="card" style="margin-bottom: 20px; padding: 20px;">
        <h2>Agendar Nova Conta</h2>
        <form action="{{ url_for('contas_a_pagar') }}" method="POST" style="display: grid; gap: 15px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label for="data_vencimento">Vencimento</label>
                    <input type="date" id="data_vencimento" name="data_vencimento" required style="width: 100%; padding: 8px; box-sizing: border-box;">
                </div>
                <div>
                    <label for="categoria">Categoria</label>
                    <select id="categoria" name="categoria" required style="width: 100%; padding: 8px; box-sizing: border-box;">
                        <option value="" selected disabled>Selecione...</option>
                        <!-- Itera apenas sobre as categorias de SAÍDA -->
                        {% for cat in categorias['saida'] %}
                        <option value="{{ cat }}">{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px;">
                <div>
                    <label for="valor">Valor (R$)</label>
                    <input type="number" id="valor" name="valor" step="0.01" placeholder="0.00" required style="width: 100%; padding: 8px; box-sizing: border-box;">
                </div>
                <div>
                    <label for="descricao">Descrição</label>
                    <input type="text" id="descricao" name="descricao" placeholder="Ex: Boleto Internet, Manutenção Caminhão..." style="width: 100%; padding: 8px; box-sizing: border-box;">
                </div>
            </div>

            <button type="submit" style="padding: 10px; background-color: #c0392b; color: white; border: none; cursor: pointer; font-weight: bold;">Agendar Conta</button>
        </form>
    </div>

    <!-- Lista de Contas Pendentes -->
    <div class="lista">
        <h2>Pendências</h2>
        {% for conta in contas %}
        <div class="transacao-item saida">
            <div class="data-box">{{ conta.data_vencimento }}</div>
            <div class="detalhes">
                <strong>{{ conta.categoria }}</strong>
                <span>{{ conta.descricao }}</span>
            </div>
            <div class="valor">R$ {{ "%.2f"|format(conta.valor) }}</div>
            
            <div style="display: flex; align-items: center;">
                <a href="{{ url_for('confirmar_pagamento', id=conta.id) }}" 
                   style="text-decoration: none; margin-left: 10px; font-size: 1.2em;"
                   onclick="return confirm('Confirmar o pagamento desta conta? O valor será debitado do caixa hoje.')"
                   title="Pagar">
                    ✅
                </a>
                <a href="{{ url_for('deletar_conta', id=conta.id) }}" 
                   class="btn-delete"
                   onclick="return confirm('Tem certeza que deseja excluir esta conta pendente?')"
                   title="Excluir">
                    &times;
                </a>
            </div>
        </div>
        {% else %}
        <div class="empty-state">
            Nenhuma conta pendente encontrada.
        </div>
        {% endfor %}
    </div>
{% endblock %}